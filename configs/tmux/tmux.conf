# Kodra Tmux Configuration
# Modern tmux setup with theme integration

# ═══════════════════════════════════════════════════════════════
# Core Settings
# ═══════════════════════════════════════════════════════════════

# Set prefix to Ctrl+Space (more ergonomic)
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase history limit
set -g history-limit 50000

# Enable true color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",ghostty:Tc"

# Faster key repetition
set -sg escape-time 0

# Focus events for vim
set -g focus-events on

# Aggressive resize for multiple clients
setw -g aggressive-resize on

# ═══════════════════════════════════════════════════════════════
# Key Bindings
# ═══════════════════════════════════════════════════════════════

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# Split panes with | and -  (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
unbind '"'
unbind %

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Navigate panes with vim keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt+arrow to switch panes (no prefix)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Resize panes with Ctrl+Shift+Arrow
bind -n C-S-Left resize-pane -L 2
bind -n C-S-Right resize-pane -R 2
bind -n C-S-Up resize-pane -U 2
bind -n C-S-Down resize-pane -D 2

# Shift+arrow to switch windows (no prefix)
bind -n S-Left previous-window
bind -n S-Right next-window

# Move windows
bind -n C-S-Left swap-window -t -1\; select-window -t -1
bind -n C-S-Right swap-window -t +1\; select-window -t +1

# Kill pane/window shortcuts
bind x kill-pane
bind X kill-window

# Toggle status bar
bind b set-option status

# ═══════════════════════════════════════════════════════════════
# Copy Mode (Vi-style)  
# ═══════════════════════════════════════════════════════════════

setw -g mode-keys vi

# Enter copy mode
bind Enter copy-mode
bind -n C-y copy-mode

# Vi-style copy
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# Copy to system clipboard
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"

# ═══════════════════════════════════════════════════════════════
# Status Bar (Top)
# ═══════════════════════════════════════════════════════════════

set -g status-position top
set -g status-interval 2
set -g status-justify left

# Status bar colors (Tokyo Night default - overridden by theme)
set -g status-style "bg=#1a1b26,fg=#c0caf5"

# Left side: session name
set -g status-left-length 40
set -g status-left "#[bg=#7aa2f7,fg=#1a1b26,bold]  #S #[bg=#1a1b26,fg=#7aa2f7]"

# Right side: date/time
set -g status-right-length 80
set -g status-right "#[fg=#414868]#[bg=#414868,fg=#c0caf5] %H:%M #[fg=#7aa2f7]#[bg=#7aa2f7,fg=#1a1b26,bold] %d-%b "

# Window tabs
set -g window-status-format "#[fg=#414868,bg=#1a1b26] #I:#W "
set -g window-status-current-format "#[fg=#1a1b26,bg=#bb9af7]#[fg=#1a1b26,bg=#bb9af7,bold] #I:#W #[fg=#bb9af7,bg=#1a1b26]"

# Pane borders
set -g pane-border-style "fg=#414868"
set -g pane-active-border-style "fg=#7aa2f7"

# Message style
set -g message-style "bg=#7aa2f7,fg=#1a1b26"

# ═══════════════════════════════════════════════════════════════
# Import Theme (set by kodra theme command)
# ═══════════════════════════════════════════════════════════════

# Source theme-specific tmux config if it exists
if-shell "test -f ~/.config/tmux/theme.conf" "source-file ~/.config/tmux/theme.conf"
